<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chengjs.cjsssmsweb.dao.master.WebUserRolePermissionDao">

  <select id="findAllByQuery" resultType="com.chengjs.cjsssmsweb.pojo.WebUser">
    SELECT
    <include refid="Base_Column_List"/>
    FROM web_user
  </select>

  <select id="list" resultType="com.chengjs.cjsssmsweb.pojo.WebUser">
    select
    <include refid="Base_Column_List"/>
    from web_user
    <where>
      <if test="username!=null and username!='' ">
        and username like #{username}
      </if>
      <if test="description!=null and description!='' ">
        and description = #{description}
      </if>
    </where>
    <if test="start!=null and size!=null">
      limit #{start},#{size}
    </if>
  </select>

  <select id="getTotal" resultType="java.lang.Long">
    select count(*) from web_user
    <where>
      <if test="username!=null and username!='' ">
        and username like #{username}
      </if>
      <if test="description!=null and description!='' ">
        and description = #{description}
      </if>
    </where>
  </select>

  <select id="findWebUserByWebUsername" resultType="com.chengjs.cjsssmsweb.pojo.WebUser">
    SELECT
    <include refid="Base_Column_List"/>
    FROM web_user WHERE username = #{username}
  </select>

  <select id="findRoleNames" resultType="java.lang.String">
    SELECT wr.rolename
    FROM web_user wu, web_con_user_role wcur, web_role wr
    WHERE wu.username = #{webUserName}
          AND wu.userid = wcur.userid
          AND wcur.roleid = wr.roleid
  </select>

  <select id="findPermissionNames" parameterType="java.util.Set" resultType="java.lang.String">
    SELECT DISTINCT wp.pername
    FROM web_role wr, web_con_role_permission wcrp, web_permission wp
    WHERE wr.roleid = wcrp.roleid
    AND wcrp.perid = wp.perid
    AND wr.rolename in
    <foreach collection="set" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>



  <resultMap id="BaseResultMap" type="com.chengjs.cjsssmsweb.pojo.WebUser">
    <id column="userid" property="userid" jdbcType="VARCHAR"/>
    <result column="password" property="password" jdbcType="VARCHAR"/>
    <result column="description" property="description" jdbcType="VARCHAR"/>
    <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
    <result column="modifytime" property="modifytime" jdbcType="TIMESTAMP"/>
    <result column="discard" property="discard" jdbcType="CHAR"/>
    <result column="username" property="username" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Base_Column_List">
    userid, password, description, createtime, modifytime, discard, username
  </sql>

</mapper>